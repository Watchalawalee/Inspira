<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Forgot Password</title>
</head>
<body>
  <h2>Forgot Password</h2>

  <!-- Step 1: ขอ PIN -->
  <form id="requestForm">
    <label>Email: <input type="email" name="email" required /></label>
    <button type="submit">Send PIN</button>
  </form>

  <br><hr><br>

  <!-- Step 2: ยืนยัน PIN และตั้งรหัสใหม่ -->
  <form id="confirmForm">
    <label>Email: <input type="email" name="email" required /></label><br>
    <label>PIN: <input type="text" name="pin" maxlength="6" required /></label><br>
    <label>New Password: <input type="password" name="newPassword" required /></label><br>
    <button type="submit">Reset Password</button>
  </form>

  <p id="result"></p>

  <script>
    // ส่งขอ PIN
    document.getElementById('requestForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const form = e.target;
      const res = await fetch('http://localhost:5000/auth/request-reset', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email: form.email.value })
      });
      const data = await res.json();
      document.getElementById('result').textContent = data.message || data.error;
    });

    // ส่ง confirm PIN + password
    document.getElementById('confirmForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const form = e.target;
      const res = await fetch('http://localhost:5000/auth/confirm-reset', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          email: form.email.value,
          pin: form.pin.value,
          newPassword: form.newPassword.value
        })
      });
      const data = await res.json();
      document.getElementById('result').textContent = data.message || data.error;
    });
  </script>
</body>
</html>
