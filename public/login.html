<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Login</title>
</head>
<body>
  <h2>Login</h2>
  <form id="loginForm">
    <input type="text" name="username" placeholder="Username" required><br><br>
    <input type="password" name="password" placeholder="Password" required><br><br>
    <button type="submit">Login</button>
  </form>

  <p id="message" style="color: red;"></p>

  <!-- ‚úÖ ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô -->
  <p>
    <a href="/forgot_password.html">üîë ‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô?</a>
  </p>

  <script>
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const form = new FormData(e.target);
      const username = form.get('username');
      const password = form.get('password');

      try {
        const res = await fetch('http://localhost:5000/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password })
        });

        const text = await res.text();
        let data;

        try {
          data = JSON.parse(text);
        } catch (e) {
          alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö');
          return;
        }

        if (!res.ok) {
          alert(data.message || data.error || '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
          return;
        }

        // ‚úÖ ‡πÄ‡∏Å‡πá‡∏ö token
        localStorage.setItem('token', data.token);

        // ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö role
        const meRes = await fetch('http://localhost:5000/auth/me', {
          headers: {
            'Authorization': 'Bearer ' + data.token
          }
        });

        const me = await meRes.json();

        if (me.role === 'admin') {
          window.location.href = '/admin.html'; // ‚úÖ ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô
        } else {
          window.location.href = '/home.html'; // ‚úÖ ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ user ‡∏õ‡∏Å‡∏ï‡∏¥
        }

      } catch (err) {
        console.error(err);
        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠');
      }
    });

  </script>
</body>
</html>
